<!DOCTYPE html>
<html>

<head>
    <base href="..">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>深入探索 - 生物群系</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon" />
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/article.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/article.css">
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <!-- 图标 -->
            <div class="navbar-header">
                <a href="./index.html">
                    <img src="./img/logo.png" id="logo" alt="首页">
                </a>
            </div>
            <!-- 导航目录 -->
            <div>
                <ul class="nav navbar-nav">
                    <li id="index">
                        <a href="./index.html">首页</a>
                    </li>
                    <li id="introduce" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            游戏介绍
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./introduce/bcground.html">游戏背景</a>
                            </li>
                            <li>
                                <a href="./introduce/experience.html">游戏历程</a>
                            </li>
                            <li>
                                <a href="./introduce/major.html">NPC</a>
                            </li>
                            <li>
                                <a href="./introduce/map.html">场景地图</a>
                            </li>
                            <li>
                                <a href="./introduce/honor.html">历史荣耀</a>
                            </li>
                            <li>
                                <a href="./introduce/system.html">特色系统</a>
                            </li>
                            <li>
                                <a href="./introduce/congigure.html">系统配置</a>
                            </li>
                        </ul>
                    </li>
                    <li id="explore" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            深入探索
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./explore/world.html">世界生成</a>
                            </li>
                            <li>
                                <a href="./explore/ecosystem.html">生物群系</a>
                            </li>
                            <li>
                                <a href="./explore/noise.html">噪声函数</a>
                            </li>
                            <li>
                                <a href="./explore/terrain.html">基本地形</a>
                            </li>
                            <li>
                                <a href="./explore/cave.html">洞穴</a>
                            </li>
                            <li>
                                <a href="./explore/explode.html">爆炸算法</a>
                            </li>
                        </ul>
                    </li>
                    <li id="strategy" class="dropdown">
                        <a href="./strategy.html" class="dropdown-toggle" data-toggle="dropdown">
                            游戏攻略
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./strategy/basempl.html">基本操作</a>
                            </li>
                            <li>
                                <a href="./strategy/sourceuse.html">材质包使用教程</a>
                            </li>
                            <li>
                                <a href="./strategy/skin.html">皮肤替换教程</a>
                            </li>
                            <li>
                                <a href="./strategy/modstall.html">MOD安装教程</a>
                            </li>

                        </ul>
                    </li>
                    <li id="about" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            关于我们
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./about/video.html">小组视频</a>
                            </li>
                            <li>
                                <a href="./about/member.html">我们的话</a>
                            </li>
                            <li>
                                <a href="./about/login.html">注册</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <script>
            $('#explore').addClass('active')
        </script>
    </nav>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="content_border">
                    <div id="content_border_top">
                        <div id="content_border_lefttop"></div>
                        <div id="content_border_centertop"></div>
                        <div id="content_border_righttop"></div>
                    </div>
                    <div id="content_border_left">
                        <div id="content_border_right">
                            <div class="content">
                                <br />
                                <!-- generated from markdown -->
                                <h1
                                    id="%E7%94%9F%E6%88%90%E7%94%9F%E7%89%A9%E7%BE%A4%E7%B3%BB%E6%80%BB%E6%B5%81%E7%A8%8B">
                                    <a href="#%E7%94%9F%E6%88%90%E7%94%9F%E7%89%A9%E7%BE%A4%E7%B3%BB%E6%80%BB%E6%B5%81%E7%A8%8B"
                                        class="anchor"></a>生成生物群系总流程</h1>
                                <p>先上效果图以白桦林为例：</p>
                                <img src="./img/baihualin.png" style="width: 100%;" alt="白桦林">

                                <p>将以下内容概括后：</p>
                                <img src="./img/flow_chart.jpg" style="width: 100%;" alt="流程图">

                                <p>然后接着上篇文章我们看到这个函数</p>
                                <p>类名net.minecraft.world.gen.ChunkProviderGenerate</p>
                                <pre><code class="hljs java">
    <span class="hljs-comment">/**
     * Will return back a chunk, if it doesn't exist and its not a MP client it will generates all the blocks for the
     * specified chunk from the map seed and chunk seed
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Chunk <span class="hljs-title">provideChunk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> z)</span>
    </span>{
        <span class="hljs-comment">// 根据区块坐标设置随机种子</span>
        <span class="hljs-keyword">this</span>.rand.setSeed((<span class="hljs-keyword">long</span>)x * <span class="hljs-number">341873128712L</span> + (<span class="hljs-keyword">long</span>)z * <span class="hljs-number">132897987541L</span>);
        <span class="hljs-comment">// 这个是生成区块时临时储存方块数据的对象，后面会转为Chunk对象</span>
        ChunkPrimer chunkprimer = <span class="hljs-keyword">new</span> ChunkPrimer();
        <span class="hljs-comment">// 生成基本地形（没有洞穴等建筑）</span>
        <span class="hljs-keyword">this</span>.setBlocksInChunk(x, z, chunkprimer);
        <span class="hljs-comment">// ...</span>
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBlocksInChunk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> z, ChunkPrimer chunkprimer)</span>
    </span>{
        <span class="hljs-comment">// 决定生物群系，这里把区块坐标*4-2了，而且结果是10*10的</span>
        <span class="hljs-keyword">this</span>.biomesForGeneration = <span class="hljs-keyword">this</span>.worldObj.getWorldChunkManager().getBiomesForGeneration(<span class="hljs-keyword">this</span>.biomesForGeneration, x * <span class="hljs-number">4</span> - <span class="hljs-number">2</span>, z * <span class="hljs-number">4</span> - <span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
        <span class="hljs-comment">// ...</span>
    }
类名net.minecraft.world.biome.WorldChunkManage
    <span class="hljs-comment">/**
     * Returns an array of biomes for the location input.
     */</span>
    <span class="hljs-keyword">public</span> BiomeGenBase[] getBiomesForGeneration(BiomeGenBase[] result, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> z, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)
    {
        IntCache.resetIntCache();

        <span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span> || result.length &lt; width * height)
        {
            result = <span class="hljs-keyword">new</span> BiomeGenBase[width * height];
        }

        <span class="hljs-comment">// 生成生物群系ID</span>
        <span class="hljs-keyword">int</span>[] biomeId = <span class="hljs-keyword">this</span>.genBiomes.getInts(x, z, width, height);

        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; width * height; ++i)
            {
                <span class="hljs-comment">// 把生物群系ID转成BiomeGenBase对象</span>
                result[i] = BiomeGenBase.getBiomeFromBiomeList(biomeId[i], BiomeGenBase.field_180279_ad);
            }

            <span class="hljs-keyword">return</span> result;
        }
        <span class="hljs-keyword">catch</span> (Throwable throwable)
        {
            <span class="hljs-comment">// ...</span>
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WorldChunkManager</span><span class="hljs-params">(<span class="hljs-keyword">long</span> seed, WorldType p_i45744_3_, String p_i45744_4_)</span>
    </span>{
        <span class="hljs-keyword">this</span>();
        <span class="hljs-keyword">this</span>.field_180301_f = p_i45744_4_;
        GenLayer[] agenlayer = GenLayer.initializeAllBiomeGenerators(seed, p_i45744_3_, p_i45744_4_);
        agenlayer = getModdedBiomeGenerators(p_i45744_3_, seed, agenlayer);
        <span class="hljs-comment">// 这里初始化了genBiomes</span>
        <span class="hljs-keyword">this</span>.genBiomes = agenlayer[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">this</span>.biomeIndexLayer = agenlayer[<span class="hljs-number">1</span>];
    }</code></pre>
                                <p>类名net.minecraft.world.biome.WorldChunkManager</p>
                                <pre><code class="hljs java">    <span class="hljs-comment">/**
     * Returns an array of biomes for the location input.
     */</span>
    <span class="hljs-keyword">public</span> BiomeGenBase[] getBiomesForGeneration(BiomeGenBase[] result, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> z, <span class="hljs-keyword">int</span> width, <span class="hljs-keyword">int</span> height)
    {
        IntCache.resetIntCache();

        <span class="hljs-keyword">if</span> (result == <span class="hljs-keyword">null</span> || result.length &lt; width * height)
        {
            result = <span class="hljs-keyword">new</span> BiomeGenBase[width * height];
        }

        <span class="hljs-comment">// 生成生物群系ID</span>
        <span class="hljs-keyword">int</span>[] biomeId = <span class="hljs-keyword">this</span>.genBiomes.getInts(x, z, width, height);

        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; width * height; ++i)
            {
                <span class="hljs-comment">// 把生物群系ID转成BiomeGenBase对象</span>
                result[i] = BiomeGenBase.getBiomeFromBiomeList(biomeId[i], BiomeGenBase.field_180279_ad);
            }

            <span class="hljs-keyword">return</span> result;
        }
        <span class="hljs-keyword">catch</span> (Throwable throwable)
        {
            <span class="hljs-comment">// ...</span>
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">WorldChunkManager</span><span class="hljs-params">(<span class="hljs-keyword">long</span> seed, WorldType p_i45744_3_, String p_i45744_4_)</span>
    </span>{
        <span class="hljs-keyword">this</span>();
        <span class="hljs-keyword">this</span>.field_180301_f = p_i45744_4_;
        GenLayer[] agenlayer = GenLayer.initializeAllBiomeGenerators(seed, p_i45744_3_, p_i45744_4_);
        agenlayer = getModdedBiomeGenerators(p_i45744_3_, seed, agenlayer);
        <span class="hljs-comment">// 这里初始化了genBiomes</span>
        <span class="hljs-keyword">this</span>.genBiomes = agenlayer[<span class="hljs-number">0</span>];
        <span class="hljs-keyword">this</span>.biomeIndexLayer = agenlayer[<span class="hljs-number">1</span>];
    }</code></pre>
                                <p>接下来就非常复杂了，net.minecraft.world.gen.layer这个包里有很多GenLayer，每层都会用上一层的输出生成这一层的输出<br><img
                                        src="./img/algorithm1.png" alt="文件1" title="文件1"><br><img
                                        src="./img/algorithm2.png" alt="文件2"
                                        title="文件2"><br>它们的初始化函数如下，最后的genlayerrivermix就是用来生成生物群系的
                                </p>
                                <p>类名net.minecraft.world.gen.layer.GenLayer</p>
                                <pre><code class="hljs java">
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> GenLayer[] initializeAllBiomeGenerators(<span class="hljs-keyword">long</span> worldSeed, WorldType worldType, String settings)
    {
        GenLayer genlayer = <span class="hljs-keyword">new</span> GenLayerIsland(<span class="hljs-number">1L</span>);
        genlayer = <span class="hljs-keyword">new</span> GenLayerFuzzyZoom(<span class="hljs-number">2000L</span>, genlayer);
        GenLayerAddIsland genlayeraddisland = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">1L</span>, genlayer);
        GenLayerZoom genlayerzoom = <span class="hljs-keyword">new</span> GenLayerZoom(<span class="hljs-number">2001L</span>, genlayeraddisland);
        GenLayerAddIsland genlayeraddisland1 = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">2L</span>, genlayerzoom);
        genlayeraddisland1 = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">50L</span>, genlayeraddisland1);
        genlayeraddisland1 = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">70L</span>, genlayeraddisland1);
        GenLayerRemoveTooMuchOcean genlayerremovetoomuchocean = <span class="hljs-keyword">new</span> GenLayerRemoveTooMuchOcean(<span class="hljs-number">2L</span>, genlayeraddisland1);
        GenLayerAddSnow genlayeraddsnow = <span class="hljs-keyword">new</span> GenLayerAddSnow(<span class="hljs-number">2L</span>, genlayerremovetoomuchocean);
        GenLayerAddIsland genlayeraddisland2 = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">3L</span>, genlayeraddsnow);
        GenLayerEdge genlayeredge = <span class="hljs-keyword">new</span> GenLayerEdge(<span class="hljs-number">2L</span>, genlayeraddisland2, GenLayerEdge.Mode.COOL_WARM);
        genlayeredge = <span class="hljs-keyword">new</span> GenLayerEdge(<span class="hljs-number">2L</span>, genlayeredge, GenLayerEdge.Mode.HEAT_ICE);
        genlayeredge = <span class="hljs-keyword">new</span> GenLayerEdge(<span class="hljs-number">3L</span>, genlayeredge, GenLayerEdge.Mode.SPECIAL);
        GenLayerZoom genlayerzoom1 = <span class="hljs-keyword">new</span> GenLayerZoom(<span class="hljs-number">2002L</span>, genlayeredge);
        genlayerzoom1 = <span class="hljs-keyword">new</span> GenLayerZoom(<span class="hljs-number">2003L</span>, genlayerzoom1);
        GenLayerAddIsland genlayeraddisland3 = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">4L</span>, genlayerzoom1);
        GenLayerAddMushroomIsland genlayeraddmushroomisland = <span class="hljs-keyword">new</span> GenLayerAddMushroomIsland(<span class="hljs-number">5L</span>, genlayeraddisland3);
        GenLayerDeepOcean genlayerdeepocean = <span class="hljs-keyword">new</span> GenLayerDeepOcean(<span class="hljs-number">4L</span>, genlayeraddmushroomisland);
        GenLayer genlayer4 = GenLayerZoom.magnify(<span class="hljs-number">1000L</span>, genlayerdeepocean, <span class="hljs-number">0</span>);
        ChunkProviderSettings chunkprovidersettings = <span class="hljs-keyword">null</span>;
        <span class="hljs-keyword">int</span> biomeSize = <span class="hljs-number">4</span>;
        <span class="hljs-keyword">int</span> riverSize = biomeSize;

        <span class="hljs-keyword">if</span> (worldType == WorldType.CUSTOMIZED &amp;&amp; settings.length() &gt; <span class="hljs-number">0</span>)
        {
            chunkprovidersettings = ChunkProviderSettings.Factory.jsonToFactory(settings).func_177864_b();
            biomeSize = chunkprovidersettings.biomeSize;
            riverSize = chunkprovidersettings.riverSize;
        }

        <span class="hljs-keyword">if</span> (worldType == WorldType.LARGE_BIOMES)
        {
            biomeSize = <span class="hljs-number">6</span>;
        }

        biomeSize = getModdedBiomeSize(worldType, biomeSize);

        GenLayer lvt_8_1_ = GenLayerZoom.magnify(<span class="hljs-number">1000L</span>, genlayer4, <span class="hljs-number">0</span>);
        GenLayerRiverInit genlayerriverinit = <span class="hljs-keyword">new</span> GenLayerRiverInit(<span class="hljs-number">100L</span>, lvt_8_1_);
        GenLayer lvt_10_1_ = GenLayerZoom.magnify(<span class="hljs-number">1000L</span>, genlayerriverinit, <span class="hljs-number">2</span>);
        GenLayer genlayerbiomeedge = worldType.getBiomeLayer(worldSeed, genlayer4, settings);
        GenLayer genlayerhills = <span class="hljs-keyword">new</span> GenLayerHills(<span class="hljs-number">1000L</span>, genlayerbiomeedge, lvt_10_1_);
        GenLayer genlayer5 = GenLayerZoom.magnify(<span class="hljs-number">1000L</span>, genlayerriverinit, <span class="hljs-number">2</span>);
        genlayer5 = GenLayerZoom.magnify(<span class="hljs-number">1000L</span>, genlayer5, riverSize);
        GenLayerRiver genlayerriver = <span class="hljs-keyword">new</span> GenLayerRiver(<span class="hljs-number">1L</span>, genlayer5);
        GenLayerSmooth genlayersmooth = <span class="hljs-keyword">new</span> GenLayerSmooth(<span class="hljs-number">1000L</span>, genlayerriver);
        genlayerhills = <span class="hljs-keyword">new</span> GenLayerRareBiome(<span class="hljs-number">1001L</span>, genlayerhills);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; biomeSize; ++i)
        {
            genlayerhills = <span class="hljs-keyword">new</span> GenLayerZoom((<span class="hljs-keyword">long</span>)(<span class="hljs-number">1000</span> + i), genlayerhills);

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>)
            {
                genlayerhills = <span class="hljs-keyword">new</span> GenLayerAddIsland(<span class="hljs-number">3L</span>, genlayerhills);
            }

            <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1</span> || biomeSize == <span class="hljs-number">1</span>)
            {
                genlayerhills = <span class="hljs-keyword">new</span> GenLayerShore(<span class="hljs-number">1000L</span>, genlayerhills);
            }
        }

        GenLayerSmooth genlayersmooth1 = <span class="hljs-keyword">new</span> GenLayerSmooth(<span class="hljs-number">1000L</span>, genlayerhills);
        GenLayerRiverMix genlayerrivermix = <span class="hljs-keyword">new</span> GenLayerRiverMix(<span class="hljs-number">100L</span>, genlayersmooth1, genlayersmooth);
        GenLayer genlayer3 = <span class="hljs-keyword">new</span> GenLayerVoronoiZoom(<span class="hljs-number">10L</span>, genlayerrivermix);
        genlayerrivermix.initWorldGenSeed(worldSeed);
        genlayer3.initWorldGenSeed(worldSeed);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> GenLayer[] {genlayerrivermix, genlayer3, genlayerrivermix};
    }</code></pre>
                                <p>以上内容来自: <a href="https://blog.csdn.net/xfgryujk/article/details/63797164">CSDN博客</a>
                                </p>

                            </div>
                        </div>
                    </div>
                    <div id="content_border_bottom">
                        <div id="content_border_leftbottom"></div>
                        <div id="content_border_centerbottom"></div>
                        <div id="content_border_rightbottom"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!--返回顶部按钮-->
    <canvas id="c_n14" height="305" width="1280"
        style="position: fixed; top: 0px; left: 0px; z-index: -1; opacity: 0.5;">
    </canvas>


    <div class="footer">
        <br>
        <p>Copyright © 2018 Badcamp 联系QQ群：869679790 联系电话：18811792366
            <a href="./about/member.html">关于我们</a>
        </p>
        <p>免责声明：本站部分内容来源于互联网。如果本站部分内容侵犯您的权益，请您告知，站长会立即处理。<br> 站内所有资源仅供学习与参考，请勿用于商业用途，否则产生的一切后果将由您自己承担！
        </p>
        <p>参考资料:minecraft官网 Google Baidu</p>
    </div>
</body>

</html>