<!DOCTYPE html>
<html>

<head>
    <base href="..">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>深入探索 - 世界生成</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon" />
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/article.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/article.css">

    <script src="./js/jquery.gototop.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <!-- 图标 -->
            <div class="navbar-header">
                <a href="./index.html">
                    <img src="./img/logo.png" id="logo" alt="首页">
                </a>
            </div>
            <!-- 导航目录 -->
            <div>
                <ul class="nav navbar-nav">
                    <li id="index">
                        <a href="./index.html">首页</a>
                    </li>
                    <li id="introduce" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            游戏介绍
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./introduce/bcground.html">游戏背景</a>
                            </li>
                            <li>
                                <a href="./introduce/experience.html">游戏历程</a>
                            </li>
                            <li>
                                <a href="./introduce/major.html">NPC</a>
                            </li>
                            <li>
                                <a href="./introduce/map.html">场景地图</a>
                            </li>
                            <li>
                                <a href="./introduce/honor.html">历史荣耀</a>
                            </li>
                            <li>
                                <a href="./introduce/system.html">特色系统</a>
                            </li>
                            <li>
                                <a href="./introduce/congigure.html">系统配置</a>
                            </li>
                        </ul>
                    </li>
                    <li id="explore" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            深入探索
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./explore/world.html">世界生成</a>
                            </li>
                            <li>
                                <a href="./explore/ecosystem.html">生物群系</a>
                            </li>
                            <li>
                                <a href="./explore/noise.html">噪声函数</a>
                            </li>
                            <li>
                                <a href="./explore/terrain.html">基本地形</a>
                            </li>
                            <li>
                                <a href="./explore/cave.html">洞穴</a>
                            </li>
                            <li>
                                <a href="./explore/explode.html">爆炸算法</a>
                            </li>
                        </ul>
                    </li>
                    <li id="strategy" class="dropdown">
                        <a href="./strategy.html" class="dropdown-toggle" data-toggle="dropdown">
                            游戏攻略
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./strategy/basempl.html">基本操作</a>
                            </li>
                            <li>
                                <a href="./strategy/sourceuse.html">材质包使用教程</a>
                            </li>
                            <li>
                                <a href="./strategy/skin.html">皮肤替换教程</a>
                            </li>
                            <li>
                                <a href="./strategy/modstall.html">MOD安装教程</a>
                            </li>

                        </ul>
                    </li>
                    <li id="about" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            关于我们
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./about/video.html">小组视频</a>
                            </li>
                            <li>
                                <a href="./about/member.html">我们的话</a>
                            </li>
                            <li>
                                <a href="./about/login.html">注册</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <script>
            $('#explore').addClass('active')
        </script>
    </nav>
    <canvas id="c_n14" height="305" width="1280" style="position: fixed; top: 0px; left: 0px; z-index: -1; opacity: 0.5;">
    </canvas>

    <!-- 返回頂部的箭頭 -->
    <div id="returntop"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div id="content_border">
                    <div id="content_border_top">
                        <div id="content_border_lefttop"></div>
                        <div id="content_border_centertop"></div>
                        <div id="content_border_righttop"></div>
                    </div>
                    <div id="content_border_left">
                        <div id="content_border_right">
                            <div class="content">
                                <br />
                                <!-- generated from markdown -->
                                <h1 id="minecraft%E4%B8%AD%E7%9A%84%E4%B8%96%E7%95%8C%E7%94%9F%E6%88%90"><a href="#minecraft%E4%B8%AD%E7%9A%84%E4%B8%96%E7%95%8C%E7%94%9F%E6%88%90" class="anchor"></a>Minecraft中的世界生成</h1>
                                <h2 id="%E4%B8%96%E7%95%8C%E8%AE%BE%E7%BD%AE"><a href="#%E4%B8%96%E7%95%8C%E8%AE%BE%E7%BD%AE" class="anchor"></a>世界设置</h2>
                                <p>首先从创建世界的GUI开始看，类名net.minecraft.client.gui.GuiCreateWorld，以下是点击按钮的代码和界面 </p>
                                <p><img src="./img/timg.jpg " style="width: 100%;" alt="主界面"> </p>
                                <p>类名net.minecraft.client.Minecraft</p>
                                <pre><code class="hljs java">    <span class="hljs-comment">/**
     * Arguments: World foldername,  World ingame name, WorldSettings
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">launchIntegratedServer</span><span class="hljs-params">(String folderName, String worldName, WorldSettings worldSettingsIn)</span>
    </span>{
        net.minecraftforge.fml.client.FMLClientHandler.instance().startIntegratedServer(folderName, worldName, worldSettingsIn);
        <span class="hljs-comment">// 首先卸载已经加载的世界</span>
        <span class="hljs-keyword">this</span>.loadWorld((WorldClient)<span class="hljs-keyword">null</span>);
        System.gc();
        ISaveHandler isavehandler = <span class="hljs-keyword">this</span>.saveLoader.getSaveLoader(folderName, <span class="hljs-keyword">false</span>);
        <span class="hljs-comment">// 世界信息，包含世界名、难度、时间、出生点等东西</span>
        WorldInfo worldinfo = isavehandler.loadWorldInfo();

        <span class="hljs-comment">// 因为是创造新的世界，这里worldinfo == null</span>
        <span class="hljs-keyword">if</span> (worldinfo == <span class="hljs-keyword">null</span> &amp;&amp; worldSettingsIn != <span class="hljs-keyword">null</span>)
        {
            worldinfo = <span class="hljs-keyword">new</span> WorldInfo(worldSettingsIn, folderName);
            isavehandler.saveWorldInfo(worldinfo);
        }

        <span class="hljs-keyword">if</span> (worldSettingsIn == <span class="hljs-keyword">null</span>)
        {
            worldSettingsIn = <span class="hljs-keyword">new</span> WorldSettings(worldinfo);
        }

        <span class="hljs-keyword">try</span>
        {
            <span class="hljs-comment">// 启动游戏服务器线程</span>
            <span class="hljs-keyword">this</span>.theIntegratedServer = <span class="hljs-keyword">new</span> IntegratedServer(<span class="hljs-keyword">this</span>, folderName, worldName, worldSettingsIn);
            <span class="hljs-keyword">this</span>.theIntegratedServer.startServerThread();
            <span class="hljs-keyword">this</span>.integratedServerIsRunning = <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">catch</span> (Throwable throwable)
        {
            CrashReport crashreport = CrashReport.makeCrashReport(throwable, <span class="hljs-string">"Starting integrated server"</span>);
            CrashReportCategory crashreportcategory = crashreport.makeCategory(<span class="hljs-string">"Starting integrated server"</span>);
            crashreportcategory.addCrashSection(<span class="hljs-string">"Level ID"</span>, folderName);
            crashreportcategory.addCrashSection(<span class="hljs-string">"Level Name"</span>, worldName);
            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ReportedException(crashreport);
        }

        <span class="hljs-keyword">this</span>.loadingScreen.displaySavingString(I18n.format(<span class="hljs-string">"menu.loadingLevel"</span>, <span class="hljs-keyword">new</span> Object[<span class="hljs-number">0</span>]));

        <span class="hljs-comment">// 轮询获取加载世界的进度并显示</span>
        <span class="hljs-keyword">while</span> (!<span class="hljs-keyword">this</span>.theIntegratedServer.serverIsInRunLoop())
        {
            <span class="hljs-keyword">if</span> (!net.minecraftforge.fml.common.StartupQuery.check())
            {
                loadWorld(<span class="hljs-keyword">null</span>);
                displayGuiScreen(<span class="hljs-keyword">null</span>);
                <span class="hljs-keyword">return</span>;
            }
            String s = <span class="hljs-keyword">this</span>.theIntegratedServer.getUserMessage();

            <span class="hljs-keyword">if</span> (s != <span class="hljs-keyword">null</span>)
            {
                <span class="hljs-keyword">this</span>.loadingScreen.displayLoadingString(I18n.format(s, <span class="hljs-keyword">new</span> Object[<span class="hljs-number">0</span>]));
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-keyword">this</span>.loadingScreen.displayLoadingString(<span class="hljs-string">""</span>);
            }

            <span class="hljs-keyword">try</span>
            {
                Thread.sleep(<span class="hljs-number">200L</span>);
            }
            <span class="hljs-keyword">catch</span> (InterruptedException var9)
            {
                ;
            }
        }

        <span class="hljs-comment">// 以下是客户端与服务器连接，这里不讨论</span>
        <span class="hljs-keyword">this</span>.displayGuiScreen((GuiScreen)<span class="hljs-keyword">null</span>);
        SocketAddress socketaddress = <span class="hljs-keyword">this</span>.theIntegratedServer.getNetworkSystem().addLocalEndpoint();
        NetworkManager networkmanager = NetworkManager.provideLocalClient(socketaddress);
        networkmanager.setNetHandler(<span class="hljs-keyword">new</span> NetHandlerLoginClient(networkmanager, <span class="hljs-keyword">this</span>, (GuiScreen)<span class="hljs-keyword">null</span>));
        networkmanager.sendPacket(<span class="hljs-keyword">new</span> C00Handshake(<span class="hljs-number">47</span>, socketaddress.toString(), <span class="hljs-number">0</span>, EnumConnectionState.LOGIN, <span class="hljs-keyword">true</span>));
        com.mojang.authlib.GameProfile gameProfile = <span class="hljs-keyword">this</span>.getSession().getProfile();
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.getSession().hasCachedProperties())
        {
            gameProfile = sessionService.fillProfileProperties(gameProfile, <span class="hljs-keyword">true</span>); <span class="hljs-comment">//Forge: Fill profile properties upon game load. Fixes MC-52974.</span>
            <span class="hljs-keyword">this</span>.getSession().setProperties(gameProfile.getProperties());
        }
        networkmanager.sendPacket(<span class="hljs-keyword">new</span> C00PacketLoginStart(gameProfile));
        <span class="hljs-keyword">this</span>.myNetworkManager = networkmanager;
    }</code></pre>
                                <h2 id="%E5%90%AF%E5%8A%A8%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8"><a href="#%E5%90%AF%E5%8A%A8%E6%B8%B8%E6%88%8F%E6%9C%8D%E5%8A%A1%E5%99%A8" class="anchor"></a>启动游戏服务器</h2>
                                <p>这里补充一些小知识，MC的单人游戏其实是在本进程内建了服务器，服务器才是负责生成世界的，客户端只负责操作输入、渲染等<br>类名net.minecraft.client.Minecraft </p>
                                <pre><code class="hljs undefined">    /**
     * Arguments: World foldername,  World ingame name, WorldSettings
     */
    public void launchIntegratedServer(String folderName, String worldName, WorldSettings worldSettingsIn)
    {
        net.minecraftforge.fml.client.FMLClientHandler.instance().startIntegratedServer(folderName, worldName, worldSettingsIn);
        // 首先卸载已经加载的世界
        this.loadWorld((WorldClient)null);
        System.gc();
        ISaveHandler isavehandler = this.saveLoader.getSaveLoader(folderName, false);
        // 世界信息，包含世界名、难度、时间、出生点等东西
        WorldInfo worldinfo = isavehandler.loadWorldInfo();

        // 因为是创造新的世界，这里worldinfo == null
        if (worldinfo == null && worldSettingsIn != null)
        {
            worldinfo = new WorldInfo(worldSettingsIn, folderName);
            isavehandler.saveWorldInfo(worldinfo);
        }

        if (worldSettingsIn == null)
        {
            worldSettingsIn = new WorldSettings(worldinfo);
        }

        try
        {
            // 启动游戏服务器线程
            this.theIntegratedServer = new IntegratedServer(this, folderName, worldName, worldSettingsIn);
            this.theIntegratedServer.startServerThread();
            this.integratedServerIsRunning = true;
        }
        catch (Throwable throwable)
        {
            CrashReport crashreport = CrashReport.makeCrashReport(throwable, "Starting integrated server");
            CrashReportCategory crashreportcategory = crashreport.makeCategory("Starting integrated server");
            crashreportcategory.addCrashSection("Level ID", folderName);
            crashreportcategory.addCrashSection("Level Name", worldName);
            throw new ReportedException(crashreport);
        }

        this.loadingScreen.displaySavingString(I18n.format("menu.loadingLevel", new Object[0]));

        // 轮询获取加载世界的进度并显示
        while (!this.theIntegratedServer.serverIsInRunLoop())
        {
            if (!net.minecraftforge.fml.common.StartupQuery.check())
            {
                loadWorld(null);
                displayGuiScreen(null);
                return;
            }
            String s = this.theIntegratedServer.getUserMessage();

            if (s != null)
            {
                this.loadingScreen.displayLoadingString(I18n.format(s, new Object[0]));
            }
            else
            {
                this.loadingScreen.displayLoadingString("");
            }

            try
            {
                Thread.sleep(200L);
            }
            catch (InterruptedException var9)
            {
                ;
            }
        }

        // 以下是客户端与服务器连接，这里不讨论
        this.displayGuiScreen((GuiScreen)null);
        SocketAddress socketaddress = this.theIntegratedServer.getNetworkSystem().addLocalEndpoint();
        NetworkManager networkmanager = NetworkManager.provideLocalClient(socketaddress);
        networkmanager.setNetHandler(new NetHandlerLoginClient(networkmanager, this, (GuiScreen)null));
        networkmanager.sendPacket(new C00Handshake(47, socketaddress.toString(), 0, EnumConnectionState.LOGIN, true));
        com.mojang.authlib.GameProfile gameProfile = this.getSession().getProfile();
        if (!this.getSession().hasCachedProperties())
        {
            gameProfile = sessionService.fillProfileProperties(gameProfile, true); //Forge: Fill profile properties upon game load. Fixes MC-52974.
            this.getSession().setProperties(gameProfile.getProperties());
        }
        networkmanager.sendPacket(new C00PacketLoginStart(gameProfile));
        this.myNetworkManager = networkmanager;
    }</code></pre>
                                <h2 id="%E5%8A%A0%E8%BD%BD%E4%B8%96%E7%95%8C"><a href="#%E5%8A%A0%E8%BD%BD%E4%B8%96%E7%95%8C" class="anchor"></a>加载世界</h2>
                                <p><img src="./img/flow_chart2.png " style="width: 100%;" alt="流程"> </p>
                                <p>类名net.minecraft.server.integrated.IntegratedServer<br>服务器线程启动后调用这个函数</p>
                                <pre><code class="hljs undefined">    /**
     * Initialises the server and starts it.
     */
    protected boolean startServer() throws IOException
    {
        logger.info("Starting integrated minecraft server version 1.8.9");
        this.setOnlineMode(true);
        this.setCanSpawnAnimals(true);
        this.setCanSpawnNPCs(true);
        this.setAllowPvp(true);
        this.setAllowFlight(true);
        logger.info("Generating keypair");
        this.setKeyPair(CryptManager.generateKeyPair());
        if (!net.minecraftforge.fml.common.FMLCommonHandler.instance().handleServerAboutToStart(this)) return false;
        // 加载所有世界（主世界、地狱、末地等）
        this.loadAllWorlds(this.getFolderName(), this.getWorldName(), this.theWorldSettings.getSeed(), this.theWorldSettings.getTerrainType(), this.theWorldSettings.getWorldName());
        this.setMOTD(this.getServerOwner() + " - " + this.worldServers[0].getWorldInfo().getWorldName());
        return net.minecraftforge.fml.common.FMLCommonHandler.instance().handleServerStarting(this);
    }


    protected void loadAllWorlds(String folderName, String worldName, long seed, WorldType type, String p_71247_6_)
    {
        this.convertMapIfNeeded(folderName);
        ISaveHandler isavehandler = this.getActiveAnvilConverter().getSaveLoader(folderName, true);
        this.setResourcePackFromWorld(this.getFolderName(), isavehandler);
        WorldInfo worldinfo = isavehandler.loadWorldInfo();

        if (worldinfo == null)
        {
            worldinfo = new WorldInfo(this.theWorldSettings, worldName);
        }
        else
        {
            worldinfo.setWorldName(worldName);
        }

        WorldServer overWorld = (isDemo() ? (WorldServer)(new DemoWorldServer(this, isavehandler, worldinfo, 0, this.theProfiler)).init() :
                                            (WorldServer)(new WorldServer(this, isavehandler, worldinfo, 0, this.theProfiler)).init());
        overWorld.initialize(this.theWorldSettings);

        // 初始化各世界
        for (int dim : net.minecraftforge.common.DimensionManager.getStaticDimensionIDs())
        {
            WorldServer world = (dim == 0 ? overWorld : (WorldServer)(new WorldServerMulti(this, isavehandler, dim, overWorld, this.theProfiler)).init());
            world.addWorldAccess(new WorldManager(this, world));
            if (!this.isSinglePlayer())
            {
                world.getWorldInfo().setGameType(getGameType());
            }
            net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.WorldEvent.Load(world));
        }

        this.getConfigurationManager().setPlayerManager(new WorldServer[]{ overWorld });

        if (overWorld.getWorldInfo().getDifficulty() == null)
        {
            this.setDifficultyForAllWorlds(this.mc.gameSettings.difficulty);
        }

        // 加载玩家附近的区块
        this.initialWorldChunkLoad();
    }


</code></pre>
                                <p>类名net.minecraft.server.MinecraftServer</p>
                                <pre><code class="hljs java">    <span class="hljs-function"><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initialWorldChunkLoad</span><span class="hljs-params">()</span>
    </span>{
        <span class="hljs-keyword">int</span> i = <span class="hljs-number">16</span>;
        <span class="hljs-keyword">int</span> j = <span class="hljs-number">4</span>;
        <span class="hljs-keyword">int</span> k = <span class="hljs-number">192</span>;
        <span class="hljs-keyword">int</span> l = <span class="hljs-number">625</span>;
        <span class="hljs-keyword">int</span> i1 = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">this</span>.setUserMessage(<span class="hljs-string">"menu.generatingTerrain"</span>);
        <span class="hljs-keyword">int</span> j1 = <span class="hljs-number">0</span>;
        logger.info(<span class="hljs-string">"Preparing start region for level "</span> + j1);
        WorldServer worldserver = net.minecraftforge.common.DimensionManager.getWorld(j1);
        BlockPos blockpos = worldserver.getSpawnPoint();
        <span class="hljs-keyword">long</span> k1 = getCurrentTimeMillis();

        <span class="hljs-comment">// MC中区块大小是16*16，所以这里是加载玩家附近25*25个区块</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> l1 = -<span class="hljs-number">192</span>; l1 &lt;= <span class="hljs-number">192</span> &amp;&amp; <span class="hljs-keyword">this</span>.isServerRunning(); l1 += <span class="hljs-number">16</span>)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i2 = -<span class="hljs-number">192</span>; i2 &lt;= <span class="hljs-number">192</span> &amp;&amp; <span class="hljs-keyword">this</span>.isServerRunning(); i2 += <span class="hljs-number">16</span>)
            {
                <span class="hljs-keyword">long</span> j2 = getCurrentTimeMillis();

                <span class="hljs-keyword">if</span> (j2 - k1 &gt; <span class="hljs-number">1000L</span>)
                {
                    <span class="hljs-keyword">this</span>.outputPercentRemaining(<span class="hljs-string">"Preparing spawn area"</span>, i1 * <span class="hljs-number">100</span> / <span class="hljs-number">625</span>);
                    k1 = j2;
                }

                ++i1;
                <span class="hljs-comment">// 加载一个区块，参数是区块坐标（方块坐标/16）</span>
                worldserver.theChunkProviderServer.loadChunk(blockpos.getX() + l1 &gt;&gt; <span class="hljs-number">4</span>, blockpos.getZ() + i2 &gt;&gt; <span class="hljs-number">4</span>);
            }
        }

        <span class="hljs-keyword">this</span>.clearCurrentTask();
    }
</code></pre>
                                <p>类名net.minecraft.world.gen.ChunkProviderServeri</p>
                                <pre><code class="hljs java">
    <span class="hljs-comment">/**
     * loads or generates the chunk at the chunk location specified
     */</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> Chunk <span class="hljs-title">loadChunk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p_73158_1_, <span class="hljs-keyword">int</span> p_73158_2_)</span>
    </span>{
        <span class="hljs-keyword">return</span> loadChunk(p_73158_1_, p_73158_2_, <span class="hljs-keyword">null</span>);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Chunk <span class="hljs-title">loadChunk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> par1, <span class="hljs-keyword">int</span> par2, Runnable runnable)</span>
    </span>{
        <span class="hljs-keyword">long</span> k = ChunkCoordIntPair.chunkXZ2Int(par1, par2);
        <span class="hljs-keyword">this</span>.droppedChunksSet.remove(Long.valueOf(k));
        Chunk chunk = (Chunk)<span class="hljs-keyword">this</span>.id2ChunkMap.getValueByKey(k);
        net.minecraft.world.chunk.storage.AnvilChunkLoader loader = <span class="hljs-keyword">null</span>;

        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.chunkLoader <span class="hljs-keyword">instanceof</span> net.minecraft.world.chunk.storage.AnvilChunkLoader)
        {
            loader = (net.minecraft.world.chunk.storage.AnvilChunkLoader) <span class="hljs-keyword">this</span>.chunkLoader;
        }

        <span class="hljs-comment">// We can only use the queue for already generated chunks</span>
        <span class="hljs-keyword">if</span> (chunk == <span class="hljs-keyword">null</span> &amp;&amp; loader != <span class="hljs-keyword">null</span> &amp;&amp; loader.chunkExists(<span class="hljs-keyword">this</span>.worldObj, par1, par2))
        {
            <span class="hljs-keyword">if</span> (runnable != <span class="hljs-keyword">null</span>)
            {
                net.minecraftforge.common.chunkio.ChunkIOExecutor.queueChunkLoad(<span class="hljs-keyword">this</span>.worldObj, loader, <span class="hljs-keyword">this</span>, par1, par2, runnable);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;
            }
            <span class="hljs-keyword">else</span>
            {
                chunk = net.minecraftforge.common.chunkio.ChunkIOExecutor.syncChunkLoad(<span class="hljs-keyword">this</span>.worldObj, loader, <span class="hljs-keyword">this</span>, par1, par2);
            }
        }
        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (chunk == <span class="hljs-keyword">null</span>)
        {
            <span class="hljs-comment">// 此时区块还未生成所以会运行到这里</span>
            chunk = <span class="hljs-keyword">this</span>.originalLoadChunk(par1, par2);
        }

        <span class="hljs-comment">// If we didn't load the chunk async and have a callback run it now</span>
        <span class="hljs-keyword">if</span> (runnable != <span class="hljs-keyword">null</span>)
        {
            runnable.run();
        }

        <span class="hljs-keyword">return</span> chunk;
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> Chunk <span class="hljs-title">originalLoadChunk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> p_73158_1_, <span class="hljs-keyword">int</span> p_73158_2_)</span>
    </span>{
        <span class="hljs-keyword">long</span> i = ChunkCoordIntPair.chunkXZ2Int(p_73158_1_, p_73158_2_);
        <span class="hljs-keyword">this</span>.droppedChunksSet.remove(Long.valueOf(i));
        Chunk chunk = (Chunk)<span class="hljs-keyword">this</span>.id2ChunkMap.getValueByKey(i);

        <span class="hljs-keyword">if</span> (chunk == <span class="hljs-keyword">null</span>)
        {
            <span class="hljs-keyword">boolean</span> added = loadingChunks.add(i);
            <span class="hljs-keyword">if</span> (!added)
            {
                net.minecraftforge.fml.common.FMLLog.bigWarning(<span class="hljs-string">"There is an attempt to load a chunk (%d,%d) in di    &gt;mension %d that is already being loaded. This will cause weird chunk breakages."</span>, p_73158_1_, p_73158_2_, worldObj.provider.getDimensionId());
            }
            chunk = net.minecraftforge.common.ForgeChunkManager.fetchDormantChunk(i, <span class="hljs-keyword">this</span>.worldObj);

            <span class="hljs-keyword">if</span> (chunk == <span class="hljs-keyword">null</span>)
            chunk = <span class="hljs-keyword">this</span>.loadChunkFromFile(p_73158_1_, p_73158_2_);

            <span class="hljs-keyword">if</span> (chunk == <span class="hljs-keyword">null</span>)
            {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.serverChunkGenerator == <span class="hljs-keyword">null</span>)
                {
                    chunk = <span class="hljs-keyword">this</span>.dummyChunk;
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-keyword">try</span>
                    {
                        <span class="hljs-comment">// 如果区块不存在，这个函数会生成区块</span>
                        chunk = <span class="hljs-keyword">this</span>.serverChunkGenerator.provideChunk(p_73158_1_, p_73158_2_);
                    }
                    <span class="hljs-keyword">catch</span> (Throwable throwable)
                    {
                        CrashReport crashreport = CrashReport.makeCrashReport(throwable, <span class="hljs-string">"Exception generating new chunk"</span>);
                        CrashReportCategory crashreportcategory = crashreport.makeCategory(<span class="hljs-string">"Chunk to be generated"</span>);
                        crashreportcategory.addCrashSection(<span class="hljs-string">"Location"</span>, String.format(<span class="hljs-string">"%d,%d"</span>, <span class="hljs-keyword">new</span> Object[] {Integer.valueOf(p_73158_1_), Integer.valueOf(p_73158_2_)}));
                        crashreportcategory.addCrashSection(<span class="hljs-string">"Position hash"</span>, Long.valueOf(i));
                        crashreportcategory.addCrashSection(<span class="hljs-string">"Generator"</span>, <span class="hljs-keyword">this</span>.serverChunkGenerator.makeString());
                        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> ReportedException(crashreport);
                    }
                }
            }

            <span class="hljs-keyword">this</span>.id2ChunkMap.add(i, chunk);
            <span class="hljs-keyword">this</span>.loadedChunks.add(chunk);
            loadingChunks.remove(i);
            chunk.onChunkLoad();
            chunk.populateChunk(<span class="hljs-keyword">this</span>, <span class="hljs-keyword">this</span>, p_73158_1_, p_73158_2_);
        }

        <span class="hljs-keyword">return</span> chunk;
    }
</code></pre>
                                <p>以上内容来自: <a href="https://blog.csdn.net/xfgryujk/article/details/61915888">CSDN博客</a></p>

                            </div>
                        </div>
                    </div>
                    <div id="content_border_bottom">
                        <div id="content_border_leftbottom"></div>
                        <div id="content_border_centerbottom"></div>
                        <div id="content_border_rightbottom"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <style>
        /*背景图片*/

        body {
            background: url(./img/bg1.jpg);
            background-size: cover;
            background-attachment: fixed;
        }
    </style>



    <!--返回顶部按钮-->

    <button class="gototop" title="返回顶部">
        <img src="./img/box2.gif">
    </button>

    <script type="text/javascript">
        $(function() {
            // $(".gototop").gototop();
            $(".gototop").gototop({
                position: 0,
                duration: 1250,
                visibleAt: 300,
                classname: "isvisible"
            });
        });
    </script>
    <div class="footer">
        <br>
        <p>Copyright © 2018 Badcamp 联系QQ群：869679790 联系电话：18811792366
            <a href="./about/member.html">关于我们</a>
        </p>
        <p>免责声明：本站部分内容来源于互联网。如果本站部分内容侵犯您的权益，请您告知，站长会立即处理。<br> 站内所有资源仅供学习与参考，请勿用于商业用途，否则产生的一切后果将由您自己承担！
        </p>
        <p>参考资料:minecraft官网 Google Baidu</p>
    </div>
</body>

</html>