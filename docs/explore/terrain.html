<!DOCTYPE html>
<html>

<head>
    <base href="..">
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>深入探索 - 基本地形</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" href="./img/favicon.png" type="image/x-icon" />
    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/highlight.js/9.12.0/styles/default.min.css" rel="stylesheet">
    <script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="./js/common.js"></script>
    <script src="./js/article.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/article.css">

    <script src="./js/jquery.gototop.min.js"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <!-- 导航栏 -->
    <nav class="navbar navbar-default" role="navigation">
        <div class="container-fluid">
            <!-- 图标 -->
            <div class="navbar-header">
                <a href="./index.html">
                    <img src="./img/logo.png" id="logo" alt="首页">
                </a>
            </div>
            <!-- 导航目录 -->
            <div>
                <ul class="nav navbar-nav">
                    <li id="index">
                        <a href="./index.html">首页</a>
                    </li>
                    <li id="introduce" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            游戏介绍
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./introduce/bcground.html">游戏背景</a>
                            </li>
                            <li>
                                <a href="./introduce/experience.html">游戏历程</a>
                            </li>
                            <li>
                                <a href="./introduce/major.html">NPC</a>
                            </li>
                            <li>
                                <a href="./introduce/map.html">场景地图</a>
                            </li>
                            <li>
                                <a href="./introduce/honor.html">历史荣耀</a>
                            </li>
                            <li>
                                <a href="./introduce/system.html">特色系统</a>
                            </li>
                            <li>
                                <a href="./introduce/congigure.html">系统配置</a>
                            </li>
                        </ul>
                    </li>
                    <li id="explore" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            深入探索
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./explore/world.html">世界生成</a>
                            </li>
                            <li>
                                <a href="./explore/ecosystem.html">生物群系</a>
                            </li>
                            <li>
                                <a href="./explore/noise.html">噪声函数</a>
                            </li>
                            <li>
                                <a href="./explore/terrain.html">基本地形</a>
                            </li>
                            <li>
                                <a href="./explore/cave.html">洞穴</a>
                            </li>
                            <li>
                                <a href="./explore/explode.html">爆炸算法</a>
                            </li>
                        </ul>
                    </li>
                    <li id="strategy" class="dropdown">
                        <a href="./strategy.html" class="dropdown-toggle" data-toggle="dropdown">
                            游戏攻略
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./strategy/basempl.html">基本操作</a>
                            </li>
                            <li>
                                <a href="./strategy/sourceuse.html">材质包使用教程</a>
                            </li>
                            <li>
                                <a href="./strategy/skin.html">皮肤替换教程</a>
                            </li>
                            <li>
                                <a href="./strategy/modstall.html">MOD安装教程</a>
                            </li>

                        </ul>
                    </li>
                    <li id="about" class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            关于我们
                            <b class="caret"></b>
                        </a>
                        <ul class="dropdown-menu">
                            <li>
                                <a href="./about/video.html">小组视频</a>
                            </li>
                            <li>
                                <a href="./about/member.html">我们的话</a>
                            </li>
                            <li>
                                <a href="./about/login.html">注册</a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <script>
            $('#explore').addClass('active')
        </script>
    </nav>

    <!--返回顶部按钮-->
    <canvas id="c_n14" height="305" width="1280" style="position: fixed; top: 0px; left: 0px; z-index: -1; opacity: 0.5;">
    </canvas>

    <!-- 返回頂部的箭頭 -->
    <div id="returntop"></div>
    <div class="container">
        <div class="row">
            <div class="col-md-2">
                <div id="sidebar">
                    <!-- generated from markdown -->
                    <ul>
                        <li><a href="#%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%BD%A2">1. 基本地形</a></li>
                        <ul>
                            <li><a href="#%3Cstrong%3E%E7%94%9F%E6%88%90%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%BD%A2%3C%2Fstrong%3E">1.1. <strong>生成基本地形</strong></a></li>
                            <li><a href="#%3Cstrong%3E%E7%94%9F%E6%88%90%E5%AF%86%E5%BA%A6%E6%95%B0%E7%BB%84%3C%2Fstrong%3E">1.2. <strong>生成密度数组</strong></a></li>
                            <li><a href="#%E7%94%9F%E6%88%90%E7%94%9F%E7%89%A9%E7%BE%A4%E7%B3%BB%E7%9B%B8%E5%BA%94%E7%9A%84%E6%96%B9%E5%9D%97">1.3. 生成生物群系相应的方块</a></li>
                            <ul>
                                <li><a href="#%E6%88%90%E5%93%81">1.3.1. 成品</a></li>
                                <li><a href="#genlayervoronoizoom">1.3.2. GenLayerVoronoiZoom</a></li>
                                <li><a href="#%E6%9B%BF%E6%8D%A2%E6%96%B9%E5%9D%97">1.3.3. 替换方块</a></li>
                            </ul>
                        </ul>
                    </ul>
                </div>
            </div>
            <div class="col-md-10">
                <div id="content_border">
                    <div id="content_border_top">
                        <div id="content_border_lefttop"></div>
                        <div id="content_border_centertop"></div>
                        <div id="content_border_righttop"></div>
                    </div>
                    <div id="content_border_left">
                        <div id="content_border_right">
                            <div class="content">
                                <br />
                                <!-- generated from markdown -->
                                <h1 id="%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%BD%A2"><a href="#%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%BD%A2" class="anchor"></a>基本地形</h1>
                                <h2 id="%3Cstrong%3E%E7%94%9F%E6%88%90%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%BD%A2%3C%2Fstrong%3E"><a href="#%3Cstrong%3E%E7%94%9F%E6%88%90%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%BD%A2%3C%2Fstrong%3E" class="anchor"></a><strong>生成基本地形</strong></h2>
                                <p>山脉：</p>
                                <img src="./img/Mountain_Biome.png" width="100%" alt="山脉">

                                <p>沙滩：</p>
                                <img src="./img/Sand_beach_2.png" width="100%" alt="沙滩">

                                <p>海洋：</p>
                                <img src="./img/1.8_Biomes_Ocean.png" width="100%" alt="海洋">


                                <p>MC不是直接生成一个高度图，而是生成一个三维</p>
                                <p>的“密度数组”，不知道为什么这样做。我猜是为了生成石窟这种地形，但是这样也有可能生成浮空岛</p>
                                <pre><code class="hljs java"> <span class="hljs-comment">// 生成只有石头、水、空气的基本地形</span>
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBlocksInChunk</span><span class="hljs-params">(<span class="hljs-keyword">int</span> xChunk, <span class="hljs-keyword">int</span> zChunk, ChunkPrimer chunkprimer)</span>
    </span>{
        <span class="hljs-comment">// 生成10*10的生物群系数组</span>
        <span class="hljs-keyword">this</span>.biomesForGeneration = <span class="hljs-keyword">this</span>.worldObj.getWorldChunkManager().getBiomesForGeneration(<span class="hljs-keyword">this</span>.biomesForGeneration, xChunk * <span class="hljs-number">4</span> - <span class="hljs-number">2</span>, zChunk * <span class="hljs-number">4</span> - <span class="hljs-number">2</span>, <span class="hljs-number">10</span>, <span class="hljs-number">10</span>);
        <span class="hljs-comment">// 生成field_147434_q这个数组，我认为它代表密度</span>
        <span class="hljs-comment">// 尺寸5*5*33，索引高位是x，中位是z，低位是y</span>
        <span class="hljs-keyword">this</span>.func_147423_a(xChunk * <span class="hljs-number">4</span>, <span class="hljs-number">0</span>, zChunk * <span class="hljs-number">4</span>);

        <span class="hljs-comment">// xyzHigh作为field_147434_q索引，要和xyzLow组合才是方块坐标</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> xHigh = <span class="hljs-number">0</span>; xHigh &lt; <span class="hljs-number">4</span>; ++xHigh)
        {
            <span class="hljs-keyword">int</span> xIndex   =  xHigh      * <span class="hljs-number">5</span>;
            <span class="hljs-keyword">int</span> xIndex_1 = (xHigh + <span class="hljs-number">1</span>) * <span class="hljs-number">5</span>;

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> zHigh = <span class="hljs-number">0</span>; zHigh &lt; <span class="hljs-number">4</span>; ++zHigh)
            {
                <span class="hljs-keyword">int</span> xzIndex =     (xIndex   + zHigh)     * <span class="hljs-number">33</span>;
                <span class="hljs-keyword">int</span> xz_1Index =   (xIndex   + zHigh + <span class="hljs-number">1</span>) * <span class="hljs-number">33</span>;
                <span class="hljs-keyword">int</span> x_1zIndex =   (xIndex_1 + zHigh)     * <span class="hljs-number">33</span>;
                <span class="hljs-keyword">int</span> x_1z_1Index = (xIndex_1 + zHigh + <span class="hljs-number">1</span>) * <span class="hljs-number">33</span>;

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> yHigh = <span class="hljs-number">0</span>; yHigh &lt; <span class="hljs-number">32</span>; ++yHigh)
                {
                    <span class="hljs-comment">// 这些线性插值后得到的density3才是每个方块的密度</span>
                    <span class="hljs-keyword">double</span> density     =  <span class="hljs-keyword">this</span>.field_147434_q[xzIndex     + yHigh];
                    <span class="hljs-keyword">double</span> densityZ1   =  <span class="hljs-keyword">this</span>.field_147434_q[xz_1Index   + yHigh];
                    <span class="hljs-keyword">double</span> densityX1   =  <span class="hljs-keyword">this</span>.field_147434_q[x_1zIndex   + yHigh];
                    <span class="hljs-keyword">double</span> densityX1Z1 =  <span class="hljs-keyword">this</span>.field_147434_q[x_1z_1Index + yHigh];
                    <span class="hljs-comment">// 步长，后同</span>
                    <span class="hljs-keyword">double</span> densityStep     = (<span class="hljs-keyword">this</span>.field_147434_q[xzIndex     + yHigh + <span class="hljs-number">1</span>] - density) / <span class="hljs-number">8</span>;
                    <span class="hljs-keyword">double</span> densityZ1Step   = (<span class="hljs-keyword">this</span>.field_147434_q[xz_1Index   + yHigh + <span class="hljs-number">1</span>] - densityZ1) / <span class="hljs-number">8</span>;
                    <span class="hljs-keyword">double</span> densityX1Step   = (<span class="hljs-keyword">this</span>.field_147434_q[x_1zIndex   + yHigh + <span class="hljs-number">1</span>] - densityX1) / <span class="hljs-number">8</span>;
                    <span class="hljs-keyword">double</span> densityX1Z1Step = (<span class="hljs-keyword">this</span>.field_147434_q[x_1z_1Index + yHigh + <span class="hljs-number">1</span>] - densityX1Z1) / <span class="hljs-number">8</span>;

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> yLow = <span class="hljs-number">0</span>; yLow &lt; <span class="hljs-number">8</span>; ++yLow)
                    {
                        <span class="hljs-keyword">double</span> density2   = density;
                        <span class="hljs-keyword">double</span> density2Z1 = densityZ1;
                        <span class="hljs-keyword">double</span> density2Step   = (densityX1 - density) / <span class="hljs-number">4</span>;
                        <span class="hljs-keyword">double</span> density2Z1Step = (densityX1Z1 - densityZ1) / <span class="hljs-number">4</span>;

                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> xLow = <span class="hljs-number">0</span>; xLow &lt; <span class="hljs-number">4</span>; ++xLow)
                        {
                            <span class="hljs-keyword">double</span> density3 = density2;
                            <span class="hljs-keyword">double</span> density3Step = (density2Z1 - density2) / <span class="hljs-number">4</span>;

                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> zLow = <span class="hljs-number">0</span>; zLow &lt; <span class="hljs-number">4</span>; ++zLow)
                            {
                                <span class="hljs-keyword">if</span> (density3 &gt; <span class="hljs-number">0.0</span>D) <span class="hljs-comment">// 密度&gt;0认为是固体</span>
                                {
                                    <span class="hljs-comment">// 设置为石头</span>
                                    chunkprimer.setBlockState(xHigh * <span class="hljs-number">4</span> + xLow, yHigh * <span class="hljs-number">8</span> + yLow, zHigh * <span class="hljs-number">4</span> + zLow, Blocks.stone.getDefaultState());
                                }
                                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (yHigh * <span class="hljs-number">8</span> + yLow &lt; <span class="hljs-keyword">this</span>.settings.seaLevel) <span class="hljs-comment">// 密度&lt;0且在海平面以下认为是液体</span>
                                {
                                    <span class="hljs-comment">// 设置为默认液体（水或岩浆）</span>
                                    chunkprimer.setBlockState(xHigh * <span class="hljs-number">4</span> + xLow, yHigh * <span class="hljs-number">8</span> + yLow, zHigh * <span class="hljs-number">4</span> + zLow, <span class="hljs-keyword">this</span>.field_177476_s.getDefaultState());
                                }
                                    <span class="hljs-comment">// 否则是空气</span>

                                density3 += density3Step;
                            }

                            density2   += density2Step;
                            density2Z1 += density2Z1Step;
                        }

                        density     += densityStep;
                        densityZ1   += densityZ1Step;
                        densityX1   += densityX1Step;
                        densityX1Z1 += densityX1Z1Step;
                    }
                }
            }
        }
    }</code></pre>
                                <h2 id="%3Cstrong%3E%E7%94%9F%E6%88%90%E5%AF%86%E5%BA%A6%E6%95%B0%E7%BB%84%3C%2Fstrong%3E"><a href="#%3Cstrong%3E%E7%94%9F%E6%88%90%E5%AF%86%E5%BA%A6%E6%95%B0%E7%BB%84%3C%2Fstrong%3E" class="anchor"></a><strong>生成密度数组</strong></h2>
                                <p>这部分应该是最重要的，然而我还是没完全看懂，这里把自己的理解写出来了</p>
                                <p>应该是最重要的，然而我还是没完全看懂，这里把自己的理解写出来了</p>
                                <pre><code class="hljs java">    <span class="hljs-comment">// 生成field_147434_q数组（密度数组），areaXZ为区块坐标*4，areaY恒为0</span>
    <span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">func_147423_a</span><span class="hljs-params">(<span class="hljs-keyword">int</span> areaX, <span class="hljs-keyword">int</span> areaY, <span class="hljs-keyword">int</span> areaZ)</span>
    </span>{
        <span class="hljs-comment">// 生成5*5*1的噪声</span>
        <span class="hljs-keyword">this</span>.field_147426_g = <span class="hljs-keyword">this</span>.noiseGen6.generateNoiseOctaves(<span class="hljs-keyword">this</span>.field_147426_g, areaX, areaZ, <span class="hljs-number">5</span>, <span class="hljs-number">5</span>, (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.depthNoiseScaleX, (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.depthNoiseScaleZ, (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.depthNoiseScaleExponent);

        <span class="hljs-keyword">float</span> coordinateScale = <span class="hljs-keyword">this</span>.settings.coordinateScale;
        <span class="hljs-keyword">float</span> heightScale = <span class="hljs-keyword">this</span>.settings.heightScale;
        <span class="hljs-comment">// 生成3个5*5*33的噪声</span>
        <span class="hljs-keyword">this</span>.field_147427_d = <span class="hljs-keyword">this</span>.field_147429_l.generateNoiseOctaves(<span class="hljs-keyword">this</span>.field_147427_d, areaX, areaY, areaZ, <span class="hljs-number">5</span>, <span class="hljs-number">33</span>, <span class="hljs-number">5</span>, (<span class="hljs-keyword">double</span>)(coordinateScale / <span class="hljs-keyword">this</span>.settings.mainNoiseScaleX), (<span class="hljs-keyword">double</span>)(heightScale / <span class="hljs-keyword">this</span>.settings.mainNoiseScaleY), (<span class="hljs-keyword">double</span>)(coordinateScale / <span class="hljs-keyword">this</span>.settings.mainNoiseScaleZ));
        <span class="hljs-keyword">this</span>.field_147428_e = <span class="hljs-keyword">this</span>.field_147431_j.generateNoiseOctaves(<span class="hljs-keyword">this</span>.field_147428_e, areaX, areaY, areaZ, <span class="hljs-number">5</span>, <span class="hljs-number">33</span>, <span class="hljs-number">5</span>, (<span class="hljs-keyword">double</span>)coordinateScale, (<span class="hljs-keyword">double</span>)heightScale, (<span class="hljs-keyword">double</span>)coordinateScale);
        <span class="hljs-keyword">this</span>.field_147425_f = <span class="hljs-keyword">this</span>.field_147432_k.generateNoiseOctaves(<span class="hljs-keyword">this</span>.field_147425_f, areaX, areaY, areaZ, <span class="hljs-number">5</span>, <span class="hljs-number">33</span>, <span class="hljs-number">5</span>, (<span class="hljs-keyword">double</span>)coordinateScale, (<span class="hljs-keyword">double</span>)heightScale, (<span class="hljs-keyword">double</span>)coordinateScale);

        <span class="hljs-keyword">int</span> index = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">int</span> xzIndex = <span class="hljs-number">0</span>;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x1 = <span class="hljs-number">0</span>; x1 &lt; <span class="hljs-number">5</span>; ++x1)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> z1 = <span class="hljs-number">0</span>; z1 &lt; <span class="hljs-number">5</span>; ++z1)
            {
                <span class="hljs-keyword">float</span> scale = <span class="hljs-number">0.0F</span>;
                <span class="hljs-keyword">float</span> groundYOffset = <span class="hljs-number">0.0F</span>;
                <span class="hljs-keyword">float</span> totalWeight = <span class="hljs-number">0.0F</span>;
                <span class="hljs-comment">// 中心点生物群系</span>
                BiomeGenBase centerBiome = <span class="hljs-keyword">this</span>.biomesForGeneration[x1 + <span class="hljs-number">2</span> + (z1 + <span class="hljs-number">2</span>) * <span class="hljs-number">10</span>];

                <span class="hljs-comment">// 求scale和groundYOffset的加权平均值</span>

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x2 = <span class="hljs-number">0</span>; x2 &lt; <span class="hljs-number">5</span>; ++x2)
                {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> z2 = <span class="hljs-number">0</span>; z2 &lt; <span class="hljs-number">5</span>; ++z2)
                    {
                        BiomeGenBase biome = <span class="hljs-keyword">this</span>.biomesForGeneration[x1 + x2 + (z1 + z2) * <span class="hljs-number">10</span>];
                        <span class="hljs-keyword">float</span> curGroundYOffset = <span class="hljs-keyword">this</span>.settings.biomeDepthOffSet + biome.minHeight * <span class="hljs-keyword">this</span>.settings.biomeDepthWeight; <span class="hljs-comment">// biomeDepthOffSet=0</span>
                        <span class="hljs-comment">// maxHeight是反混淆错误吧，应该是scale</span>
                        <span class="hljs-keyword">float</span> curScale = <span class="hljs-keyword">this</span>.settings.biomeScaleOffset + biome.maxHeight * <span class="hljs-keyword">this</span>.settings.biomeScaleWeight; <span class="hljs-comment">// biomeScaleOffset=0</span>

                        <span class="hljs-comment">// 世界类型是巨型生物群系</span>
                        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.field_177475_o == WorldType.AMPLIFIED &amp;&amp; curGroundYOffset &gt; <span class="hljs-number">0.0F</span>)
                        {
                            curGroundYOffset = <span class="hljs-number">1.0F</span> + curGroundYOffset * <span class="hljs-number">2.0F</span>;
                            curScale = <span class="hljs-number">1.0F</span> + curScale * <span class="hljs-number">4.0F</span>;
                        }

                        <span class="hljs-comment">// parabolicField为 10 / √(该点到中心点的距离^2 + 0.2)</span>
                        <span class="hljs-keyword">float</span> weight = <span class="hljs-keyword">this</span>.parabolicField[x2 + z2 * <span class="hljs-number">5</span>] / (curGroundYOffset + <span class="hljs-number">2.0F</span>);

                        <span class="hljs-keyword">if</span> (biome.minHeight &gt; centerBiome.minHeight)
                        {
                            weight /= <span class="hljs-number">2.0F</span>;
                        }

                        scale += curScale * weight;
                        groundYOffset += curGroundYOffset * weight;
                        totalWeight += weight;
                    }
                }

                scale = scale / totalWeight;
                groundYOffset = groundYOffset / totalWeight;
                scale = scale * <span class="hljs-number">0.9F</span> + <span class="hljs-number">0.1F</span>;
                groundYOffset = (groundYOffset * <span class="hljs-number">4.0F</span> - <span class="hljs-number">1.0F</span>) / <span class="hljs-number">8.0F</span>;

                <span class="hljs-comment">// 这部分大概是取一个-0.36~0.125的随机数，这个随机数决定了起伏的地表</span>

                <span class="hljs-keyword">double</span> random = <span class="hljs-keyword">this</span>.field_147426_g[xzIndex] / <span class="hljs-number">8000.0</span>D;

                <span class="hljs-keyword">if</span> (random &lt; <span class="hljs-number">0.0</span>D)
                {
                    random = -random * <span class="hljs-number">0.3</span>D;
                }

                random = random * <span class="hljs-number">3.0</span>D - <span class="hljs-number">2.0</span>D;

                <span class="hljs-keyword">if</span> (random &lt; <span class="hljs-number">0.0</span>D)
                {
                    random = random / <span class="hljs-number">2.0</span>D;

                    <span class="hljs-keyword">if</span> (random &lt; -<span class="hljs-number">1.0</span>D)
                    {
                        random = -<span class="hljs-number">1.0</span>D;
                    }

                    random = random / <span class="hljs-number">1.4</span>D;
                    random = random / <span class="hljs-number">2.0</span>D;
                }
                <span class="hljs-keyword">else</span>
                {
                    <span class="hljs-keyword">if</span> (random &gt; <span class="hljs-number">1.0</span>D)
                    {
                        random = <span class="hljs-number">1.0</span>D;
                    }

                    random = random / <span class="hljs-number">8.0</span>D;
                }

                <span class="hljs-keyword">double</span> _groundYOffset = (<span class="hljs-keyword">double</span>)groundYOffset;
                <span class="hljs-keyword">double</span> _scale = (<span class="hljs-keyword">double</span>)scale;
                <span class="hljs-comment">// groundYOffset有-0.072~0.025的变动量</span>
                _groundYOffset = _groundYOffset + random * <span class="hljs-number">0.2</span>D;
                <span class="hljs-comment">/*_groundYOffset = _groundYOffset * (double)this.settings.baseSize / 8.0D;
                double groundY = (double)this.settings.baseSize + _groundYOffset * 4.0D;*/</span>
                <span class="hljs-comment">// 这个是大概的地面y坐标，实际上也没有保证不会出现浮空岛...</span>
                <span class="hljs-keyword">double</span> groundY = (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.baseSize * (<span class="hljs-number">1.0</span>D + _groundYOffset / <span class="hljs-number">2.0</span>D); <span class="hljs-comment">// baseSize=8.5，应该代表了平均地表高度68</span>

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-number">33</span>; ++y) <span class="hljs-comment">// 注意这个y*8才是最终的y坐标</span>
                {
                    <span class="hljs-comment">// result偏移量，这个是负数则趋向固体，是正数则趋向液体和空气</span>
                    <span class="hljs-keyword">double</span> offset = ((<span class="hljs-keyword">double</span>)y - groundY) * (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.stretchY * <span class="hljs-number">128.0</span>D / <span class="hljs-number">256.0</span>D / _scale; <span class="hljs-comment">// scale大概在0.1~0.2这样...</span>

                    <span class="hljs-keyword">if</span> (offset &lt; <span class="hljs-number">0.0</span>D)
                    {
                        offset *= <span class="hljs-number">4.0</span>D;
                    }

                    <span class="hljs-comment">// 并不保证lowerLimit &lt; upperLimit，不过没有影响</span>
                    <span class="hljs-keyword">double</span> lowerLimit = <span class="hljs-keyword">this</span>.field_147428_e[index] / (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.lowerLimitScale; <span class="hljs-comment">// lowerLimitScale=512</span>
                    <span class="hljs-keyword">double</span> upperLimit = <span class="hljs-keyword">this</span>.field_147425_f[index] / (<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.settings.upperLimitScale; <span class="hljs-comment">// upperLimitScale=512</span>
                    <span class="hljs-keyword">double</span> t = (<span class="hljs-keyword">this</span>.field_147427_d[index] / <span class="hljs-number">10.0</span>D + <span class="hljs-number">1.0</span>D) / <span class="hljs-number">2.0</span>D;
                    <span class="hljs-comment">// 这个函数t &lt; 0则取lowerLimit，t &gt; 1则取upperLimit，否则以t为参数在上下限间线性插值</span>
                    <span class="hljs-keyword">double</span> result = MathHelper.denormalizeClamp(lowerLimit, upperLimit, t) - offset;

                    <span class="hljs-keyword">if</span> (y &gt; <span class="hljs-number">29</span>) <span class="hljs-comment">// y = 30~32</span>
                    {
                        <span class="hljs-comment">// 在原result和-10之间线性插值，这样y &gt; 240的方块就会越来越少，最后全变成空气</span>
                        <span class="hljs-keyword">double</span> t2 = (<span class="hljs-keyword">double</span>)((<span class="hljs-keyword">float</span>)(y - <span class="hljs-number">29</span>) / <span class="hljs-number">3.0F</span>);
                        result = result * (<span class="hljs-number">1.0</span>D - t2) + -<span class="hljs-number">10.0</span>D * t2;
                    }

                    <span class="hljs-keyword">this</span>.field_147434_q[index] = result;
                    ++index;
                }

                ++xzIndex;
            }
        }
    }
</code></pre>
                                <h2 id="%E7%94%9F%E6%88%90%E7%94%9F%E7%89%A9%E7%BE%A4%E7%B3%BB%E7%9B%B8%E5%BA%94%E7%9A%84%E6%96%B9%E5%9D%97"><a href="#%E7%94%9F%E6%88%90%E7%94%9F%E7%89%A9%E7%BE%A4%E7%B3%BB%E7%9B%B8%E5%BA%94%E7%9A%84%E6%96%B9%E5%9D%97"
                                        class="anchor"></a>生成生物群系相应的方块</h2>
                                <h3 id="%E6%88%90%E5%93%81"><a href="#%E6%88%90%E5%93%81" class="anchor"></a>成品</h3>
                                <p>高寒生物群系</p>
                                <img src="./img/800px-Extreme_Hills_M.png" width="100%" alt="高寒">

                                <p>积雪生物群系：</p>
                                <img src="./img/800px-IcePlains.png" width="100%" alt="雪原">

                                <p>茂盛生物群系：</p>
                                <img src="./img/2012-01-04_19.47.47.png" width="100%" alt="平原">

                                <h3 id="genlayervoronoizoom"><a href="#genlayervoronoizoom" class="anchor"></a>GenLayerVoronoiZoom</h3>
                                <p>Voronoi图是用来划分平面的，使得每个区域内的点到它所在区域的种子点的距离比到其它区域种子点的距离近</p>
                                <p>它的上一层是GenLayerRiverMix，之前用它生成了10<em>10的生物群系ID，这里就要扩展成16</em>16的</p>
                                <pre><code class="hljs java">
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span>[] getInts(<span class="hljs-keyword">int</span> areaX, <span class="hljs-keyword">int</span> areaY, <span class="hljs-keyword">int</span> areaWidth, <span class="hljs-keyword">int</span> areaHeight)
    {
        areaX = areaX - <span class="hljs-number">2</span>;
        areaY = areaY - <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> parentAreaX = areaX &gt;&gt; <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> parentAreaY = areaY &gt;&gt; <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> parentWidth = (areaWidth &gt;&gt; <span class="hljs-number">2</span>) + <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> parentHeight = (areaHeight &gt;&gt; <span class="hljs-number">2</span>) + <span class="hljs-number">2</span>;
        <span class="hljs-comment">// parentRes是本层的1/4</span>
        <span class="hljs-keyword">int</span>[] parentRes = <span class="hljs-keyword">this</span>.parent.getInts(parentAreaX, parentAreaY, parentWidth, parentHeight);
        <span class="hljs-keyword">int</span> tmpWidth = parentWidth - <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">2</span>;
        <span class="hljs-keyword">int</span> tmpHeight = parentHeight - <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">2</span>;
        <span class="hljs-comment">// 临时结果</span>
        <span class="hljs-keyword">int</span>[] tmp = IntCache.getIntCache(tmpWidth * tmpHeight);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> parentY = <span class="hljs-number">0</span>; parentY &lt; parentHeight - <span class="hljs-number">1</span>; ++parentY)
        {
            <span class="hljs-comment">// parent当前点的值</span>
            <span class="hljs-keyword">int</span> parentValue   = parentRes[parentY * parentWidth];
            <span class="hljs-comment">// parent当前点y+1点的值</span>
            <span class="hljs-keyword">int</span> parentValueY1 = parentRes[(parentY + <span class="hljs-number">1</span>) * parentWidth];

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> parentX = <span class="hljs-number">0</span>; parentX &lt; parentWidth - <span class="hljs-number">1</span>; ++parentX)
            {
                <span class="hljs-comment">// 随机取parent的4个点的坐标</span>
                <span class="hljs-keyword">this</span>.initChunkSeed((parentX + parentAreaX) &lt;&lt; <span class="hljs-number">2</span>, (parentY + parentAreaY) &lt;&lt; <span class="hljs-number">2</span>);
                <span class="hljs-keyword">double</span> vertex1X = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D;
                <span class="hljs-keyword">double</span> vertex1Y = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D;
                <span class="hljs-keyword">this</span>.initChunkSeed((parentX + parentAreaX + <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">2</span>, (parentY + parentAreaY) &lt;&lt; <span class="hljs-number">2</span>);
                <span class="hljs-keyword">double</span> vertex2X = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D + <span class="hljs-number">4.0</span>D;
                <span class="hljs-keyword">double</span> vertex2Y = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D;
                <span class="hljs-keyword">this</span>.initChunkSeed((parentX + parentAreaX) &lt;&lt; <span class="hljs-number">2</span>, (parentY + parentAreaY + <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">2</span>);
                <span class="hljs-keyword">double</span> vertex3X = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D;
                <span class="hljs-keyword">double</span> vertex3Y = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D + <span class="hljs-number">4.0</span>D;
                <span class="hljs-keyword">this</span>.initChunkSeed((parentX + parentAreaX + <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">2</span>, (parentY + parentAreaY + <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">2</span>);
                <span class="hljs-keyword">double</span> vertex4X = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D + <span class="hljs-number">4.0</span>D;
                <span class="hljs-keyword">double</span> vertex4Y = ((<span class="hljs-keyword">double</span>)<span class="hljs-keyword">this</span>.nextInt(<span class="hljs-number">1024</span>) / <span class="hljs-number">1024.0</span>D - <span class="hljs-number">0.5</span>D) * <span class="hljs-number">3.6</span>D + <span class="hljs-number">4.0</span>D;

                <span class="hljs-keyword">int</span> parentValueX1   = parentRes[parentX + <span class="hljs-number">1</span> +  parentY      * parentWidth] % <span class="hljs-number">256</span>;
                <span class="hljs-keyword">int</span> parentValueX1Y1 = parentRes[parentX + <span class="hljs-number">1</span> + (parentY + <span class="hljs-number">1</span>) * parentWidth] % <span class="hljs-number">256</span>;

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> yLow = <span class="hljs-number">0</span>; yLow &lt; <span class="hljs-number">4</span>; ++yLow)
                {
                    <span class="hljs-keyword">int</span> tmpIndex = ((parentY &lt;&lt; <span class="hljs-number">2</span>) + yLow) * tmpWidth + (parentX &lt;&lt; <span class="hljs-number">2</span>);

                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> xLow = <span class="hljs-number">0</span>; xLow &lt; <span class="hljs-number">4</span>; ++xLow)
                    {
                        <span class="hljs-comment">// 当前点到parent各点的距离的平方</span>
                        <span class="hljs-keyword">double</span> dist1 = ((<span class="hljs-keyword">double</span>)yLow - vertex1Y) * ((<span class="hljs-keyword">double</span>)yLow - vertex1Y) + ((<span class="hljs-keyword">double</span>)xLow - vertex1X) * ((<span class="hljs-keyword">double</span>)xLow - vertex1X);
                        <span class="hljs-keyword">double</span> dist2 = ((<span class="hljs-keyword">double</span>)yLow - vertex2Y) * ((<span class="hljs-keyword">double</span>)yLow - vertex2Y) + ((<span class="hljs-keyword">double</span>)xLow - vertex2X) * ((<span class="hljs-keyword">double</span>)xLow - vertex2X);
                        <span class="hljs-keyword">double</span> dist3 = ((<span class="hljs-keyword">double</span>)yLow - vertex3Y) * ((<span class="hljs-keyword">double</span>)yLow - vertex3Y) + ((<span class="hljs-keyword">double</span>)xLow - vertex3X) * ((<span class="hljs-keyword">double</span>)xLow - vertex3X);
                        <span class="hljs-keyword">double</span> dist4 = ((<span class="hljs-keyword">double</span>)yLow - vertex4Y) * ((<span class="hljs-keyword">double</span>)yLow - vertex4Y) + ((<span class="hljs-keyword">double</span>)xLow - vertex4X) * ((<span class="hljs-keyword">double</span>)xLow - vertex4X);

                        <span class="hljs-comment">// 取最近点的值</span>
                        <span class="hljs-keyword">if</span> (dist1 &lt; dist2 &amp;&amp; dist1 &lt; dist3 &amp;&amp; dist1 &lt; dist4)
                        {
                            tmp[tmpIndex++] = parentValue;
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dist2 &lt; dist1 &amp;&amp; dist2 &lt; dist3 &amp;&amp; dist2 &lt; dist4)
                        {
                            tmp[tmpIndex++] = parentValueX1;
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dist3 &lt; dist1 &amp;&amp; dist3 &lt; dist2 &amp;&amp; dist3 &lt; dist4)
                        {
                            tmp[tmpIndex++] = parentValueY1;
                        }
                        <span class="hljs-keyword">else</span>
                        {
                            tmp[tmpIndex++] = parentValueX1Y1;
                        }
                    }
                }

                <span class="hljs-comment">// parent当前点移动x+1</span>
                parentValue = parentValueX1;
                parentValueY1 = parentValueX1Y1;
            }
        }

        <span class="hljs-keyword">int</span>[] result = IntCache.getIntCache(areaWidth * areaHeight);

        <span class="hljs-comment">// tmp和result尺寸可能不同，这里把tmp左上角部分复制到result</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> resultY = <span class="hljs-number">0</span>; resultY &lt; areaHeight; ++resultY)
        {
            System.arraycopy(tmp, (resultY + areaY % <span class="hljs-number">2</span>) * tmpWidth + (areaX % <span class="hljs-number">2</span>), result, resultY * areaWidth, areaWidth);
        }

        <span class="hljs-keyword">return</span> result;
    }</code></pre>
                                <h3 id="%E6%9B%BF%E6%8D%A2%E6%96%B9%E5%9D%97"><a href="#%E6%9B%BF%E6%8D%A2%E6%96%B9%E5%9D%97" class="anchor"></a>替换方块</h3>
                                <pre><code class="hljs java">
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">replaceBlocksForBiome</span><span class="hljs-params">(<span class="hljs-keyword">int</span> chunkX, <span class="hljs-keyword">int</span> chunkZ, ChunkPrimer chunkprimer, BiomeGenBase[] biomes)</span>
    </span>{
        net.minecraftforge.event.terraingen.ChunkProviderEvent.ReplaceBiomeBlocks event = <span class="hljs-keyword">new</span> net.minecraftforge.event.terraingen.ChunkProviderEvent.ReplaceBiomeBlocks(<span class="hljs-keyword">this</span>, chunkX, chunkZ, chunkprimer, <span class="hljs-keyword">this</span>.worldObj);
        net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(event);
        <span class="hljs-keyword">if</span> (event.getResult() == net.minecraftforge.fml.common.eventhandler.Event.Result.DENY) <span class="hljs-keyword">return</span>;

        <span class="hljs-keyword">double</span> coordinateScale = <span class="hljs-number">0.03125</span>D;
        <span class="hljs-comment">// 生成16*16的噪声</span>
        <span class="hljs-keyword">this</span>.stoneNoise = <span class="hljs-keyword">this</span>.field_147430_m.func_151599_a(<span class="hljs-keyword">this</span>.stoneNoise, (<span class="hljs-keyword">double</span>)(chunkX * <span class="hljs-number">16</span>), (<span class="hljs-keyword">double</span>)(chunkZ * <span class="hljs-number">16</span>), <span class="hljs-number">16</span>, <span class="hljs-number">16</span>, coordinateScale * <span class="hljs-number">2.0</span>D, coordinateScale * <span class="hljs-number">2.0</span>D, <span class="hljs-number">1.0</span>D);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-number">16</span>; ++x)
        {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> z = <span class="hljs-number">0</span>; z &lt; <span class="hljs-number">16</span>; ++z)
            {
                BiomeGenBase biomegenbase = biomes[z + x * <span class="hljs-number">16</span>];
                biomegenbase.genTerrainBlocks(<span class="hljs-keyword">this</span>.worldObj, <span class="hljs-keyword">this</span>.rand, chunkprimer, chunkX * <span class="hljs-number">16</span> + x, chunkZ * <span class="hljs-number">16</span> + z, <span class="hljs-keyword">this</span>.stoneNoise[z + x * <span class="hljs-number">16</span>]);
            }
        }
    }</code></pre>
                                <p>类名<code>net.minecraft.world.biome.BiomeGenBase</code></p>
                                <pre><code class="hljs java">
    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">genTerrainBlocks</span><span class="hljs-params">(World worldIn, Random rand, ChunkPrimer chunkPrimerIn, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> z, <span class="hljs-keyword">double</span> noise)</span>
    </span>{
        <span class="hljs-keyword">this</span>.generateBiomeTerrain(worldIn, rand, chunkPrimerIn, x, z, noise);
    }

    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">void</span> <span class="hljs-title">generateBiomeTerrain</span><span class="hljs-params">(World worldIn, Random rand, ChunkPrimer chunkPrimerIn, <span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> z, <span class="hljs-keyword">double</span> noise)</span>
    </span>{
        <span class="hljs-keyword">int</span> seaLevel = worldIn.getSeaLevel();
        IBlockState topBlock = <span class="hljs-keyword">this</span>.topBlock; <span class="hljs-comment">// 最顶部的方块，比如草方块</span>
        IBlockState fillerBlock = <span class="hljs-keyword">this</span>.fillerBlock; <span class="hljs-comment">// 顶部以下用来填充的方块，比如泥土</span>
        <span class="hljs-comment">// 还需要填充几个方块</span>
        <span class="hljs-keyword">int</span> rest = -<span class="hljs-number">1</span>;
        <span class="hljs-comment">// 需要填充的方块数</span>
        <span class="hljs-keyword">int</span> fillerCount = (<span class="hljs-keyword">int</span>)(noise / <span class="hljs-number">3.0</span>D + <span class="hljs-number">3.0</span>D + rand.nextDouble() * <span class="hljs-number">0.25</span>D);
        <span class="hljs-keyword">int</span> xLow = x % <span class="hljs-number">16</span>;
        <span class="hljs-keyword">int</span> zLow = z % <span class="hljs-number">16</span>;
        BlockPos.MutableBlockPos pos = <span class="hljs-keyword">new</span> BlockPos.MutableBlockPos();

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> y = <span class="hljs-number">255</span>; y &gt;= <span class="hljs-number">0</span>; --y)
        {
            <span class="hljs-keyword">if</span> (y &lt;= rand.nextInt(<span class="hljs-number">5</span>))
            {
                <span class="hljs-comment">// y &lt;= 5随机替换为基岩</span>
                chunkPrimerIn.setBlockState(zLow, y, xLow, Blocks.bedrock.getDefaultState());
            }
            <span class="hljs-keyword">else</span>
            {
                IBlockState curBlock = chunkPrimerIn.getBlockState(zLow, y, xLow);

                <span class="hljs-keyword">if</span> (curBlock.getBlock().getMaterial() == Material.air) <span class="hljs-comment">// 还在空气层，不需要填充</span>
                {
                    rest = -<span class="hljs-number">1</span>;
                }
                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (curBlock.getBlock() == Blocks.stone) <span class="hljs-comment">// 石头层</span>
                {
                    <span class="hljs-keyword">if</span> (rest == -<span class="hljs-number">1</span>) <span class="hljs-comment">// 还没开始填充</span>
                    {
                        <span class="hljs-comment">// 到这里y应该在石头与空气和水的分界面</span>

                        <span class="hljs-keyword">if</span> (fillerCount &lt;= <span class="hljs-number">0</span>) <span class="hljs-comment">// 不需要填充</span>
                        {
                            topBlock = <span class="hljs-keyword">null</span>;
                            fillerBlock = Blocks.stone.getDefaultState();
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &gt;= seaLevel - <span class="hljs-number">4</span> &amp;&amp; y &lt;= seaLevel + <span class="hljs-number">1</span>) <span class="hljs-comment">// 需要填充，且在海平面附近</span>
                        {
                            topBlock = <span class="hljs-keyword">this</span>.topBlock;
                            fillerBlock = <span class="hljs-keyword">this</span>.fillerBlock;
                        } <span class="hljs-comment">// 其他情况说明在海底，topBlock、fillerBlock不变</span>

                        <span class="hljs-comment">// 在海平面以下，且不需要填充</span>
                        <span class="hljs-keyword">if</span> (y &lt; seaLevel &amp;&amp; (topBlock == <span class="hljs-keyword">null</span> || topBlock.getBlock().getMaterial() == Material.air))
                        {
                            <span class="hljs-comment">// 根据温度顶部替换为冰或水</span>
                            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.getFloatTemperature(pos.set(x, y, z)) &lt; <span class="hljs-number">0.15F</span>)
                            {
                                topBlock = Blocks.ice.getDefaultState();
                            }
                            <span class="hljs-keyword">else</span>
                            {
                                topBlock = Blocks.water.getDefaultState();
                            }
                        }

                        <span class="hljs-comment">// 开始填充顶部</span>
                        rest = fillerCount;

                        <span class="hljs-keyword">if</span> (y &gt;= seaLevel - <span class="hljs-number">1</span>) <span class="hljs-comment">// 海平面以上</span>
                        {
                            <span class="hljs-comment">// 顶部替换为topBlock</span>
                            chunkPrimerIn.setBlockState(zLow, y, xLow, topBlock);
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (y &lt; seaLevel - <span class="hljs-number">7</span> - fillerCount) <span class="hljs-comment">// 海底</span>
                        {
                            topBlock = <span class="hljs-keyword">null</span>;
                            <span class="hljs-comment">// 接下来使用石头填充</span>
                            fillerBlock = Blocks.stone.getDefaultState();
                            <span class="hljs-comment">// 顶部替换为砂砾</span>
                            chunkPrimerIn.setBlockState(zLow, y, xLow, Blocks.gravel.getDefaultState());
                        }
                        <span class="hljs-keyword">else</span> <span class="hljs-comment">// 海平面以下但不是太深的地方</span>
                        {
                            <span class="hljs-comment">// 没有顶部了，直接替换为fillerBlock</span>
                            chunkPrimerIn.setBlockState(zLow, y, xLow, fillerBlock);
                        }
                    }
                    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (rest &gt; <span class="hljs-number">0</span>) <span class="hljs-comment">// 正在填充</span>
                    {
                        --rest;
                        <span class="hljs-comment">// 替换为fillerBlock</span>
                        chunkPrimerIn.setBlockState(zLow, y, xLow, fillerBlock);

                        <span class="hljs-comment">// 如果之前填充了沙子则下面还要填充沙岩</span>
                        <span class="hljs-keyword">if</span> (rest == <span class="hljs-number">0</span> &amp;&amp; fillerBlock.getBlock() == Blocks.sand)
                        {
                            rest = rand.nextInt(<span class="hljs-number">4</span>) + Math.max(<span class="hljs-number">0</span>, y - <span class="hljs-number">63</span>);
                            fillerBlock = fillerBlock.getValue(BlockSand.VARIANT) == BlockSand.EnumType.RED_SAND ? Blocks.red_sandstone.getDefaultState() : Blocks.sandstone.getDefaultState();
                        }
                    } <span class="hljs-comment">// rest = 0说明填充完毕</span>
                }
            }
        }
    }</code></pre>
                                <p>以上内容来自: <a href="https://blog.csdn.net/xfgryujk/article/details/65437654">CSDN博客</a></p>

                            </div>
                        </div>
                    </div>
                    <div id="content_border_bottom">
                        <div id="content_border_leftbottom"></div>
                        <div id="content_border_centerbottom"></div>
                        <div id="content_border_rightbottom"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <button class="gototop" title="返回顶部">
        <img src="./img/box2.gif">
    </button>

    <script type="text/javascript">
        $(function() {
            // $(".gototop").gototop();
            $(".gototop").gototop({
                position: 0,
                duration: 1250,
                visibleAt: 300,
                classname: "isvisible"
            });
        });
    </script>
    <div class="footer">
        <br>
        <p>Copyright © 2018 Badcamp 联系QQ群：869679790 联系电话：18811792366
            <a href="./about/member.html">关于我们</a>
        </p>
        <p>免责声明：本站部分内容来源于互联网。如果本站部分内容侵犯您的权益，请您告知，站长会立即处理。<br> 站内所有资源仅供学习与参考，请勿用于商业用途，否则产生的一切后果将由您自己承担！
        </p>
        <p>参考资料:minecraft官网 Google Baidu</p>
    </div>
</body>

</html>